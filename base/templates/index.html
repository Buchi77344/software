{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel = "stylesheet" href = "static/css/style.css"/>
    <script src = "{% static 'js/script.js' %}" defer></script>
    <title>User Page</title>

    <script>
        window.addEventListener('beforeunload', function (event) {
            // Send AJAX request to pause the exam session when the user closes the tab
            navigator.sendBeacon('{% url 'save_time' %}', JSON.stringify({
                'paused': true  // Add the correct subject ID in your template
            }));
        });
    </script>
    
    
        
        
</head>
<body>
    <div class = "page">
        <div class="popup-overlay">
            <div class="popup-div">
                <h3 class = "popup-head">Are you sure you want to submit</h3>
                <div class = "popup-btn-container">
                    <button  class = "exam Yes-btn">Yes, I'm sure</button>
                    <button class = "No-btn">No, Not Yet</button>
                </div>
            </div>
        </div>
        <div class="time popup-overlay">
            <div class="time popup-div">
                <h3 class = "time popup-head">You Have Less Than Five minutes Left</h3>
                <div class = "popup-btn-container">
                    <button class = "ok-btn">Click Ok, To Continue</button>
                </div>
            </div>
        </div>
        <div class = "wrapper">
            <div class = "main-sidebar">
                <div class = "menu">
                    <div class= "menu-head flex-between">
                        <div class="hamburger flex-column">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>

                        <div class = "menu-head-content flex gp-10">
                            <div class = "scholar-icon-div flex-center">
                                <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
                                <!-- Uploaded to: SVG Repo, www.svgrepo.com, Transformed by: SVG Repo Mixer Tools -->
                                <svg fill="#0ead8d" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 484.006 484.006" xml:space="preserve">
                                    <g id="SVGRepo_bgCarrier" stroke-width="0"/>
                                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>
                                    <g id="SVGRepo_iconCarrier"> <g> <g> <polygon points="484.006,189.845 484.006,179.186 241.897,62.561 0,179.083 0,189.946 241.897,306.471 "/> <path d="M83.808,251.571v69.7l145.836,70.25h24.506l145.435-70.057c0.14-0.307,0.271-0.613,0.402-0.922V251.57l-158.09,76.152 L83.808,251.571z"/> <polygon points="458.506,358.195 458.506,222.599 439.359,232.255 439.359,358.195 426.883,396.203 445.742,421.445 452.123,421.445 470.981,396.203 "/> </g> </g> </g>
                                </svg>
                            </div>
                            <div class = "text-content-div flex-column">
                                <span class = "sub-text">Hi there</span>
                                <span class = "text">{{username.user.username}}</span>
                            </div>
                        </div>
                    </div>
                    <div class= "user menu-content flex-column ">
                        <div class = "subjects-link-div flex-column">
                            {% for subject_data in all_subjects_questions %}
                           
                                <div data-menu = "{{subject_data.subject.name|upper}}" class="menu-wrapper flex gp-10">
                                    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
                                    <!-- Uploaded to: SVG Repo, www.svgrepo.com, Transformed by: SVG Repo Mixer Tools -->
                                    <svg fill="#f5f5f5" height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512.00 512.00" xml:space="preserve" stroke="#f5f5f5" stroke-width="20">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"/>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>
                                        <g id="SVGRepo_iconCarrier"> <g> <g> <path d="M503.983,4.276H256H8.017C3.589,4.276,0,7.865,0,12.292v102.614v384.802c0,4.427,3.589,8.017,8.017,8.017H256h247.983 c4.427,0,8.017-3.589,8.017-8.017V114.906V12.292C512,7.865,508.411,4.276,503.983,4.276z M495.967,491.691H256H16.033V122.923 H256h239.967V491.691z M495.967,106.889H256H16.033v-86.58H256h239.967V106.889z"/> </g> </g> <g> <g> <path d="M427.023,38.48H332.96c-4.427,0-8.017,3.589-8.017,8.017c0,4.427,3.589,8.017,8.017,8.017h94.063 c4.427,0,8.017-3.589,8.017-8.017C435.04,42.07,431.45,38.48,427.023,38.48z"/> </g> </g> <g> <g> <path d="M469.779,38.48h-17.102c-4.427,0-8.017,3.589-8.017,8.017c0,4.427,3.589,8.017,8.017,8.017h17.102 c4.427,0,8.017-3.589,8.017-8.017C477.795,42.07,474.206,38.48,469.779,38.48z"/> </g> </g> <g> <g> <path d="M264.551,29.929c-3.835,0-7.612,0.647-11.222,1.924c-0.009,0.003-0.016,0.008-0.025,0.01 c-13.412,4.754-22.423,17.504-22.423,31.737c0,14.232,9.011,26.982,22.422,31.737c0.009,0.003,0.016,0.008,0.025,0.011 c3.611,1.276,7.387,1.924,11.222,1.924c18.566,0,33.67-15.105,33.67-33.67S283.117,29.929,264.551,29.929z M264.551,81.236 c-2.011,0-3.988-0.339-5.88-1.007c-0.001,0-0.002-0.001-0.003-0.001c-7.03-2.488-11.754-9.17-11.754-16.629 s4.723-14.14,11.755-16.629c0.001,0,0.002,0,0.003-0.001c1.891-0.669,3.869-1.007,5.88-1.007c9.725,0,17.637,7.912,17.637,17.637 S274.276,81.236,264.551,81.236z"/> </g> </g> <g> <g> <path d="M170.489,29.929c-18.566,0-33.67,15.105-33.67,33.67s15.105,33.67,33.67,33.67s33.67-15.104,33.67-33.67 S189.054,29.929,170.489,29.929z M170.489,81.236c-9.725,0-17.637-7.912-17.637-17.637s7.912-17.637,17.637-17.637 s17.637,7.912,17.637,17.637S180.213,81.236,170.489,81.236z"/> </g> </g> <g> <g> <path d="M76.426,29.929c-18.566,0-33.67,15.105-33.67,33.67s15.105,33.67,33.67,33.67s33.67-15.104,33.67-33.67 S94.992,29.929,76.426,29.929z M76.426,81.236c-9.725,0-17.637-7.912-17.637-17.637s7.912-17.637,17.637-17.637 s17.637,7.912,17.637,17.637S86.151,81.236,76.426,81.236z"/> </g> </g> <g> <g> <path d="M480.454,214.537l-84.651-84.653c-3.131-3.131-8.207-3.131-11.338,0L330.5,183.85H256H72.15 c-4.427,0-8.017,3.589-8.017,8.017s3.589,8.017,8.017,8.017H256h58.466l-64.135,64.135l-56.65,56.65H72.15 c-4.427,0-8.017,3.589-8.017,8.017s3.589,8.017,8.017,8.017h105.497l-17.278,17.278c-0.009,0.009-0.017,0.017-0.027,0.027 l-0.014,0.014c-0.025,0.025-0.045,0.051-0.069,0.077c-0.159,0.164-0.314,0.332-0.461,0.51c-0.055,0.065-0.1,0.135-0.153,0.202 c-0.108,0.14-0.216,0.28-0.315,0.429c-0.065,0.097-0.122,0.199-0.183,0.299c-0.074,0.122-0.151,0.243-0.218,0.37 c-0.068,0.128-0.127,0.26-0.188,0.39c-0.049,0.105-0.102,0.207-0.146,0.315c-0.067,0.162-0.124,0.329-0.181,0.495 c-0.028,0.082-0.06,0.161-0.086,0.245c-0.064,0.212-0.117,0.426-0.162,0.642c-0.009,0.042-0.022,0.081-0.031,0.123l-0.005,0.025 c-0.002,0.01-0.004,0.019-0.005,0.029l-19.862,99.316H72.15c-4.427,0-8.017,3.589-8.017,8.017c0,4.427,3.589,8.017,8.017,8.017 h72.641c0.012,0,0.023,0.001,0.036,0.001c0.003,0,0.005,0,0.009,0c0.003,0,0.005,0,0.009,0c0.012,0,0.024-0.001,0.036-0.001h6.276 c2.139,0,4.077-0.843,5.514-2.208l35.038-7.008c0.005-0.001,0.01-0.002,0.015-0.003l0.032-0.006l60.415-12.083 c0.007-0.001,0.015-0.003,0.023-0.004l0.028-0.005c0.047-0.01,0.091-0.025,0.138-0.035c0.21-0.046,0.419-0.096,0.625-0.158 c0.088-0.027,0.171-0.061,0.258-0.09c0.161-0.056,0.324-0.11,0.482-0.175c0.112-0.047,0.219-0.102,0.328-0.153 c0.126-0.059,0.253-0.115,0.377-0.182c0.13-0.07,0.253-0.148,0.378-0.223c0.097-0.059,0.197-0.114,0.291-0.177 c0.149-0.099,0.29-0.208,0.431-0.316c0.066-0.051,0.136-0.097,0.201-0.152c0.175-0.144,0.341-0.297,0.503-0.455 c0.027-0.027,0.057-0.048,0.082-0.075l0.016-0.016c0.009-0.009,0.017-0.016,0.025-0.025l5.309-5.309l110.306-110.306 l48.015-48.015l60.465-60.465C483.584,222.743,483.584,217.667,480.454,214.537z M202.669,334.353 c0.001-0.001,0.002-0.002,0.003-0.002l58.998-58.998l68-68l15.872,15.873L193.208,375.56l-15.873-15.873L202.669,334.353z M356.878,234.564l18.896,18.896l-69.556,69.556l-55.886,55.886l-26.891,26.891l-18.896-18.896L356.878,234.564z M155.055,455.283 l3.774-18.869l15.095,15.095L155.055,455.283z M192.819,447.731l-30.211-30.211l8.314-41.57l16.618,16.618l30.233,30.233 l16.618,16.617L192.819,447.731z M360.637,323.016L250.65,433.002l-15.873-15.872l26.891-26.891l55.886-55.886l69.556-69.556 l15.872,15.872L360.637,323.016z M414.32,269.332l-21.54-21.54l-30.234-30.233l-21.54-21.541l49.129-49.128l73.314,73.314 L414.32,269.332z"/> </g> </g> <g> <g> <path d="M394.211,169.096c-3.13-3.131-8.207-3.131-11.337,0l-19.24,19.24c-3.131,3.131-3.131,8.207,0,11.337 c1.565,1.565,3.617,2.348,5.668,2.348s4.103-0.782,5.668-2.348l19.24-19.24C397.342,177.302,397.342,172.225,394.211,169.096z"/> </g> </g> </g>
                                    </svg>
                                    <span>{{ subject_data.subject.name }}</span>
                                </div>
                            {% endfor %}
                        </div>
                        
                        <div class = "calculator-menu menu-item">
                            <div class="calculator-menu-wrapper flex gp-10">
                                <?xml version="1.0" encoding="utf-8"?>
                                <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
                                <svg width="800px" height="800px" viewBox="0 0 1024 1024" class="arrow-icon"  version="1.1" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M768 903.232l-50.432 56.768L256 512l461.568-448 50.432 56.768L364.928 512z" fill="#f5f5f5" />
                                </svg>
                                <span>Calculator</span>
                            </div>
                            
                            <div class = "calculator-container">
                                <div class = "calculator">
                                    <div class = "calculator-screen">0</div>
                                    <div class="calculator-btn-container">
                                        <button class="calculator-button">CLR</button>
                                        <button class="calculator-button">DEL</button>
                                        <button class="calculator-button">%</button>
                                        <button class="calculator-button">/</button>
                                        <button class="calculator-button">7</button>
                                        <button class="calculator-button">8</button>
                                        <button class="calculator-button">9</button>
                                        <button class="calculator-button">*</button>
                                        <button class="calculator-button">4</button>
                                        <button class="calculator-button">5</button>
                                        <button class="calculator-button">6</button>
                                        <button class="calculator-button">-</button>
                                        <button class="calculator-button">1</button>
                                        <button class="calculator-button">2</button>
                                        <button class="calculator-button">3</button>
                                        <button class="calculator-button">+</button>
                                        <button class="calculator-button">.</button>
                                        <button class="calculator-button">0</button>
                                        <button class="calculator-button large">=</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class = "key-shrt-container">
                            <div class="carousel-shrt">
                                <div class = "active questions-shortcut-container shrt-container">
                                    <strong class = "shortcut-list-strong">Keyboard Shortcuts For Questions:</strong>
                                    <ul class="shortcut-list">
                                        <li>Press <span class="shortcut">N</span> for "Next" question</li>
                                        <li>Press <span class="shortcut">R</span> for "Previous" question</li>
                                        <li>Press <span class="shortcut">A</span> for option "A"</li>
                                        <li>Press <span class="shortcut">B</span> for option "B"</li>
                                        <li>Press <span class="shortcut">C</span> for option "C"</li>
                                        <li>Press <span class="shortcut">D</span> for option "D"</li>
                                        <li>Press <span class="shortcut">S</span> to submit the test</li>
                                    </ul>
                                </div>
    
                                <div class = "calculator-shorcut-container shrt-container">
                                    <strong class = "shortcut-list-strong">Keyboard Shortcuts For Calculator:</strong>
                                    <ul class="shortcut-list">
                                        <li>Press any number from <span class="shortcut">0 - 9</span> for numbers selection</li>
                                        <li>Press <span class="shortcut">ESC</span> to remove all values from the screen</li>
                                        <li>Press <span class="shortcut">BACKSPACE</span> to delete a value or operator</li>
                                        <li>Press <span class="shortcut"> =</span> to get the result of your operation</li>
                                        <li>Press <span class="shortcut"> the correct keys pattern for [ + , - , * , / ]</span>to peform arithmetic operations</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    
                    
                     
                    </div>
                </div>
            </div>

            <div class = "main-content">
                <div class="main-content-header flex-between">
                    <div class = "school-name-div">
                        <?xml version="1.0" encoding="utf-8"?>
                        <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
                        <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M11.7071 4.29289C12.0976 4.68342 12.0976 5.31658 11.7071 5.70711L6.41421 11H20C20.5523 11 21 11.4477 21 12C21 12.5523 20.5523 13 20 13H6.41421L11.7071 18.2929C12.0976 18.6834 12.0976 19.3166 11.7071 19.7071C11.3166 20.0976 10.6834 20.0976 10.2929 19.7071L3.29289 12.7071C3.10536 12.5196 3 12.2652 3 12C3 11.7348 3.10536 11.4804 3.29289 11.2929L10.2929 4.29289C10.6834 3.90237 11.3166 3.90237 11.7071 4.29289Z" fill="#000000"/>
                        </svg>
                        <span>{{school_name}}</span>
                    </div>

                    <button type="button" class="answer-submit-btn">Submit Answers</button>
                </div>
                <div class = "main-content-items-wrapper flex gp-15">
                    <div class = "control-section flex-column gp-10">
                        <div class= "small-box-info">
                            <h4 class = "control small-box-head">{{ selected_subject.name|upper }}</h4>
                            <p class = "small-box-text">Good Luck</p>
                        </div>
                        <div class= "small-box-info">
                            <h4 class = "small-box-head">Time remaining</h4>
                            <p id = "timer" class = "small-box-text">08 : 15 : 30</p>
                        </div>
                        <div class= "Question-select-box small-box-info">
                            <h4 class = "small-box-head">Questions remaining</h4>
                            <div class = "question-numbers-div">
                                {% for subject_data in all_subjects_questions %}
                                    {% for question in subject_data.questions %}
                                    <span data-number = "{{subject_data.subject.name}}" class = "question-number">{{forloop.counter}}</span>
                                    {%  endfor %}
                                {% endfor %}
                            </div>
                        </div>

                        <div class= "small-box-info">
                            <h4 class = "small-box-head">Number Of Questions</h4>
                            <p class = "number_of_questions small-box-text"> Questions Total: {{total_questions}}</p>
                        </div>
                    </div>

                    <div class = "question-section">
                        
                        <form class="user-question-form" method="post" action="{% url 'index' %}">
                            {% csrf_token %}
                        
                            {% if all_subjects_questions %}
                                {% for subject_data in all_subjects_questions %}
                                    <div data-current-question = "0" data-box = "{{subject_data.subject.name}}" class="subject-box flex-column gp-15">
                                        <h3 class="subject-title">{{ subject_data.subject.name }}</h3>
                                    
                                        {% for question in subject_data.questions %}
                                            <div class="question-box">
                                                <div class="question-box-head flex-center">
                                                    <h4 class="small-box-head">Question {{ forloop.counter }}</h4>
                                                </div>
                        
                                                <div class="question-text">
                                                    <p>{{ question.text }}</p>
                                                </div>
                        
                                                <div class="answers-wrapper flex-column">
                                                    <div class="answers-container flex-column">
                                                        {% if question.diagram %}
                                                            <img src="{{ question.diagram.url }}" alt="Diagram">
                                                        {% endif %}
                                                        {% for answer in question.answers.all %}
                                                            <div class="answer-item">
                                                                <input type="radio" name="question_{{ question.id }}" value="{{ answer.id }}" id="answer_{{ answer.id }}" class="check-answer"
                                                                {% if user_answers.question.id == answer.id %} checked{% endif %}/>
                                                                <label for="answer_{{ answer.id }}">{{ answer.text }}</label>
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                            {% endif %}
                        
                            <!-- <div class="user-question-btn-container flex-between">
                            </div> -->
                        </form>
                        
                        <div class = "no-questions">
                            <h3></h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>

        document.addEventListener('contextmenu', function(event){
            event.preventDefault();
        })


        
      
        
        
        

        let timerDiv = document.querySelector("#timer");
        let warningMessage = "";
        let inactivityTimeout;
        const inactivityDuration = 3 * 60 * 1000; // 3 minutes in milliseconds
        let indexindexPopupVisible = false;
        const subjectBoxes = document.querySelectorAll(".subject-box")
        
        //let answerBtn = document.querySelector(".answer-submit-btn")
        // Function to show the popup
        function showTimePopup() {
            document.querySelector(".time.popup-overlay").style.display = "grid";
             indexPopupVisible = true;
            setTimeout(() => {
                document.querySelector(".time.popup-div").classList.add("visible");
            }, 100);
        }

        // Function to remove the popup
        function removeTimePopup() {
            document.querySelector(".time.popup-div").classList.remove("visible");
            indexPopupVisible = false;
            setTimeout(() => {
                document.querySelector(".time.popup-overlay").style.display = "none";
            }, 100);
        }

        function logoutSubmitAnswer(){
            document.querySelector(".popup-overlay").style.visibility = "hidden"
            userQuestionForm.submit()
        }

        // Event listener for the OK button
        document.querySelector(".ok-btn").addEventListener("click", function () {
            console.log("ok-btn");
            removeTimePopup();
            resetInactivityTimer(); // Reset inactivity timer after user clicks OK
        });

        // Function to format time into HH:MM:SS
        function formatTimeFunc(seconds) {
            let time_hours = Math.floor(seconds / 3600);
            let time_min = Math.floor((seconds % 3600) / 60);
            let time_secs = seconds % 60;

            let formatedTime = String(time_hours).padStart(2, "0") + ":" + String(time_min).padStart(2, "0") + ":" + String(time_secs).padStart(2, "0");
            return formatedTime;
        }

        // Function to start countdown timer
        function startCountDown(timeSeconds) {
            let remainingSeconds = timeSeconds;
            console.log(remainingSeconds)
            function updateTimer() {
                if (remainingSeconds >= 0) {
                    let timeString = formatTimeFunc(remainingSeconds);
                    timerDiv.textContent = timeString;
                    remainingSeconds--;
                } else {
                    clearInterval(timeInterval);
                    if (document.querySelectorAll(".question-box").length > 0) {
                        logoutSubmitAnswer();
                    }
                }

                if (remainingSeconds <= 300) {
                    timerDiv.style.color = "#b51e0b";
                }

                if (remainingSeconds === 300) {
                    console.log("updateTimer");
                    warningMessage = "You Have Five minutes Left";
                    document.querySelector(".time.popup-head").textContent = warningMessage;
                    showTimePopup();
                }
            }

            updateTimer();
            let timeInterval = setInterval(updateTimer, 1000);
        }

        startCountDown("{{ remaining_time|floatformat:0 }}");
        if(subjectBoxes.length > 0){
            // Function to show inactivity popup
            function showInactivityPopup() {
                warningMessage = 'You have been inactive for 3 minutes. Please select an answer to continue.';
                document.querySelector(".time.popup-head").textContent = warningMessage;
                showTimePopup();
            }
    
            // Function to reset inactivity timer
            function resetInactivityTimer() {
                clearTimeout(inactivityTimeout);
                inactivityTimeout = setTimeout(showInactivityPopup, inactivityDuration);
            }
    
            // Add event listeners for user interaction to reset the inactivity timer
            window.addEventListener("mousemove", resetInactivityTimer);
            window.addEventListener("keydown", resetInactivityTimer);
            window.addEventListener("scroll", resetInactivityTimer);
            window.addEventListener("click", resetInactivityTimer);
    
            // Initialize the inactivity timer
            resetInactivityTimer();


        }    
    </script>
    <!-- <script>
       function logoutSubmitAnswer(){
            answerBtn.type = "submit"
            document.querySelector(".popup-overlay").style.visibility = "hidden"
            answerBtn.click()
        }
        document.addEventListener('DOMContentLoaded', (event) => {
            let inactivityTime = function () {
                let time;
                const warningMessage = 'You have been inactive for 10 seconds. Please select an answer to continue.';
    
                // Function to display the warning message
                function displayWarning() {
                    alert(warningMessage);
                }
    
                // Reset timer on user interaction
                function resetTimer() {
                    clearTimeout(time);
                    sessionStorage.setItem('lastInteractionTime', new Date().getTime());
                    time = setTimeout(displayWarning, 10000); // 10 seconds = 10000 milliseconds
                }
    
                // Function to check if the user has been inactive for a while
                function checkInactivity() {
                    const lastInteractionTime = sessionStorage.getItem('lastInteractionTime');
                    if (lastInteractionTime) {
                        const now = new Date().getTime();
                        const inactiveDuration = now - parseInt(lastInteractionTime, 10);
                        if (inactiveDuration >= 10000) { // 10 seconds
                            displayWarning();
                        }
                    }
                    resetTimer();
                }
    
                // Initialize the last interaction time if not set
                if (!sessionStorage.getItem('lastInteractionTime')) {
                    sessionStorage.setItem('lastInteractionTime', new Date().getTime());
                }
    
                // Event listeners to reset timer on interaction
                document.addEventListener('click', resetTimer, true);
                document.addEventListener('keydown', resetTimer, true);
                document.addEventListener('mousemove', resetTimer, true);
    
                // Check for inactivity on page load
                checkInactivity();
            };
    
            inactivityTime(); // Run the inactivity timer function
        });

        My modified
         document.addEventListener('DOMContentLoaded', (event) => {
            let inactivityTime = function () {
                let time;
                warningMessage = 'You have been inactive for 3 minutes. Please select an answer to continue.';
    
                // Function to display the warning message
                function displayWarning() {
                    document.querySelector(".time.popup-head").textContent = warningMessage
                    showTimePopup()
                }
    
                // Reset timer on user interaction
                function resetTimer() {
                    clearTimeout(time);
                    sessionStorage.setItem('lastInteractionTime', new Date().getTime());
                    time = setTimeout(displayWarning, 180000); // 180 seconds = 180000 milliseconds
                }
    
                // Function to check if the user has been inactive for a while
                function checkInactivity() {
                    const lastInteractionTime = sessionStorage.getItem('lastInteractionTime');
                    if (lastInteractionTime) {
                        const now = new Date().getTime();
                        const inactiveDuration = now - parseInt(lastInteractionTime, 10);
                        if (inactiveDuration >= 180000) { // 10 seconds
                            console.log("inactivity")
                            displayWarning();
                        }
                    }
                    resetTimer();
                }
    
                // Initialize the last interaction time if not set
                if (!sessionStorage.getItem('lastInteractionTime')) {
                    sessionStorage.setItem('lastInteractionTime', new Date().getTime());
                }
    
                // Event listeners to reset timer on interaction
              /**  document.addEventListener('click', resetTimer, true);
                document.addEventListener('keydown', resetTimer, true);
                document.addEventListener('mousemove', resetTimer, true);**/
    
                // Check for inactivity on page load
                checkInactivity();
            };
    
            inactivityTime(); // Run the inactivity timer function
        });
    </script> -->
   
</body>
</html>

<script>
    // Detect when the user switches tabs, closes the tab, or minimizes the browser
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            navigator.sendBeacon('/api/update-status/', JSON.stringify({
                'is_online': false
            }));
        }
    });

    // Detect when the user goes offline (loses network connection)
    window.addEventListener('offline', function(event) {
        fetch('/api/update-status/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'  // Include the CSRF token for Django
            },
            body: JSON.stringify({'is_online': false})
        });
    });
</script>


<script>
 /**   document.addEventListener('DOMContentLoaded', function () {
        let userExamSessionId = "{{ user_exam_session_id }}";
        let remainingSeconds = {{ remaining_time|floatformat:0 }}; // Get the remaining time from Django
        console.log(remainingSeconds)
        // Function to send the remaining time to the backend when the tab is closed
        function sendPauseSignal() {
            if (userExamSessionId) {
                navigator.sendBeacon('{% url 'save_time' %}', JSON.stringify({
                    'user_exam_session_id': userExamSessionId,
                    'remaining_time': remainingSeconds
                }));
            }
        }
    
        // Update remaining time every second
        function updateRemainingTime() {
            if (remainingSeconds > 0) {
                remainingSeconds--;
            }
        }
    
        // Call updateRemainingTime every second
        setInterval(updateRemainingTime, 1000);
    
        // Send pause signal when the user closes the tab
        window.addEventListener('beforeunload', function (event) {
            sendPauseSignal();
        });
    });**/
    </script>
    
<script>
    function getTrueValue() {
        fetch("{% url 'handle_get_request' %}")
        .then(response => response.json())
        .then(data => {
            console.log('Received:', data);  // This should log "true"

            if (data.value == true) {
                // Perform your desired action here
              //  alert('True value received from the server!');
              document.querySelector(".user-question-form").submit()
            }
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }

    setInterval(getTrueValue, 5000)
    </script>